const { Client } = require('@elastic/elasticsearch');
const client = new Client({ node: 'http://localhost:9200' }); // replace with your elastic search node URL

// Function to search clinics based on user input
async function searchClinics(zipCode, options) {
    try {
        const { body } = await client.search({
            index: 'clinics',
            body: {
                query: {
                    bool: {
                        must: [
                            {
                                match: {
                                    zip: zipCode,
                                },
                            },
                            {
                                bool: {
                                    should: [
                                        {
                                            match: {
                                                practiceHub: options.practiceHub,
                                            },
                                        },
                                        {
                                            match: {
                                                televet_services: options.televet_services,
                                            },
                                        },
                                        {
                                            match: {
                                                accepts_insurance: options.accepts_insurance,
                                            },
                                        },
                                        {
                                            match: {
                                                emergency_services: options.emergency_services,
                                            },
                                        },
                                        {
                                            terms: {
                                                categories: options.categories,
                                            },
                                        },
                                    ],
                                },
                            },
                        ],
                    },
                },
            },
        });
        return body.hits.hits.map((hit) => hit._source);
    } catch (error) {
        console.trace(error.message);
    }
}

// Example usage
const zipCode = '01752';
const options = {
    practiceHub: true,
    televet_services: false,
    accepts_insurance: true,
    emergency_services: false,
    categories: ['Food Animal', 'Swine'],
};
searchClinics(zipCode, options)
    .then((results) => console.log(results))
    .catch((error) => console.error(error));
